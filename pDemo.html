<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>A sparse MPC solver for walking motion generation.: A simple demo</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">A sparse MPC solver for walking motion generation.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>A simple demo </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="pDemo1"></a>
Include headers:</h2>
<p><div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;cmath&gt;</span> <span class="comment">// M_PI</span>


<span class="preprocessor">#include &quot;<a class="code" href="WMG_8h.html">WMG.h</a>&quot;</span>    <span class="comment">// a helper class</span>
<span class="preprocessor">#include &quot;<a class="code" href="smpc__solver_8h.html" title="Interface of the library.">smpc_solver.h</a>&quot;</span>    <span class="comment">// the interface of the library</span>



<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
    <span class="comment">//-----------------------------------------------------------</span>
</pre></div></p>
<h2><a class="anchor" id="pDemo2"></a>
Define footsteps:</h2>
<p><div class="fragment"><pre class="fragment">    <span class="comment">// initialize</span>

    <span class="comment">// WMG is a helper class, which provides data for QP on each</span>
    <span class="comment">// iteration of simulation</span>
    <a class="code" href="classWMG.html" title="Defines the parameters of the Walking Pattern Generator.">WMG</a> wmg;

    wmg.<a class="code" href="classWMG.html#a0758ae4958f2d9ca521141ca9331517d" title="Initializes a WMG object.">init</a> (
            15,     <span class="comment">// size of the preview window</span>
            0.1,    <span class="comment">// sampling time [sec.]</span>
            0.261); <span class="comment">// height of the center of mass [meter]</span>


    <span class="comment">// Initial double support</span>
    <span class="keywordtype">double</span> d[4] = {0.09 , 0.075, 0.03, 0.025};
    wmg.<a class="code" href="classWMG.html#a22369d281e86ade4b07ab6c9c8aa42ac" title="Adds a footstep to FS; sets the default constraints, the total number of iterations and the number of...">AddFootstep</a>(0.0, 0.0, 0.0, 2, 3, d, <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449ac92a7214504e35546f6bff550f2d07d0">FS_TYPE_DS</a>);
    <span class="comment">// ZMP, CoM are at [0;0]</span>

    <span class="comment">// each step is defined relatively to the previous step</span>
    <span class="keywordtype">double</span> z = 5.0*M_PI/180.0;  <span class="comment">// relative angle</span>
    <span class="keywordtype">double</span> step_x = 0.035;      <span class="comment">// relative X position</span>
    <span class="keywordtype">double</span> step_y = 0.1;        <span class="comment">// relative Y position</span>

    <span class="comment">// all subsequent steps have normal feet size</span>
    d[0] = 0.09;
    d[1] = 0.025;
    d[2] = 0.03;
    d[3] = 0.025;
    <span class="comment">// 2 reference ZMP positions in single support </span>
    <span class="comment">// 1 in double support</span>
    <span class="comment">// 1 + 2 = 3</span>
    wmg.<a class="code" href="classWMG.html#a22369d281e86ade4b07ab6c9c8aa42ac" title="Adds a footstep to FS; sets the default constraints, the total number of iterations and the number of...">AddFootstep</a>(0.0   , -step_y/2, 0.0 , 2,  3, d);
    wmg.<a class="code" href="classWMG.html#a22369d281e86ade4b07ab6c9c8aa42ac" title="Adds a footstep to FS; sets the default constraints, the total number of iterations and the number of...">AddFootstep</a>(step_x,  step_y, z);
    wmg.<a class="code" href="classWMG.html#a22369d281e86ade4b07ab6c9c8aa42ac" title="Adds a footstep to FS; sets the default constraints, the total number of iterations and the number of...">AddFootstep</a>(step_x, -step_y, z);
    wmg.<a class="code" href="classWMG.html#a22369d281e86ade4b07ab6c9c8aa42ac" title="Adds a footstep to FS; sets the default constraints, the total number of iterations and the number of...">AddFootstep</a>(step_x,  step_y, z);
    wmg.<a class="code" href="classWMG.html#a22369d281e86ade4b07ab6c9c8aa42ac" title="Adds a footstep to FS; sets the default constraints, the total number of iterations and the number of...">AddFootstep</a>(step_x, -step_y, z);
    wmg.<a class="code" href="classWMG.html#a22369d281e86ade4b07ab6c9c8aa42ac" title="Adds a footstep to FS; sets the default constraints, the total number of iterations and the number of...">AddFootstep</a>(step_x,  step_y, z);
    wmg.<a class="code" href="classWMG.html#a22369d281e86ade4b07ab6c9c8aa42ac" title="Adds a footstep to FS; sets the default constraints, the total number of iterations and the number of...">AddFootstep</a>(step_x, -step_y, z);
    wmg.<a class="code" href="classWMG.html#a22369d281e86ade4b07ab6c9c8aa42ac" title="Adds a footstep to FS; sets the default constraints, the total number of iterations and the number of...">AddFootstep</a>(step_x,  step_y, 0.0);

    <span class="comment">// here we give many reference points, since otherwise we </span>
    <span class="comment">// would not have enough steps in preview window to reach </span>
    <span class="comment">// the last footsteps</span>
    d[0] = 0.09;
    d[1] = 0.025;
    d[2] = 0.03;
    d[3] = 0.075;
    wmg.<a class="code" href="classWMG.html#a22369d281e86ade4b07ab6c9c8aa42ac" title="Adds a footstep to FS; sets the default constraints, the total number of iterations and the number of...">AddFootstep</a>(0.0   , -step_y/2, 0.0, 30, 30, d, <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449ac92a7214504e35546f6bff550f2d07d0">FS_TYPE_DS</a>);
    <span class="comment">//-----------------------------------------------------------</span>
</pre></div></p>
<h2><a class="anchor" id="pDemo3"></a>
Setup solver:</h2>
<p><div class="fragment"><pre class="fragment">

    <a class="code" href="classsmpc__solver.html" title="API of the sparse MPC solver.">smpc_solver</a> solver(
            wmg.<a class="code" href="classWMG.html#abb248bd581bb239890067b5a73b4c4bd" title="Number of iterations in a preview window.">N</a>); <span class="comment">// size of the preview window</span>
                    <span class="comment">// other parameters are optional</span>
    <span class="comment">//-----------------------------------------------------------</span>
</pre></div> The gains are defined <a class="el" href="pProblemDef.html#pGains">here</a>. The default values of optional parameters can be found here: <a class="el" href="classsmpc__solver.html#aaaefe82472f792a12d266b0c69f04681" title="Constructor: initialization of the constant parameters.">smpc_solver::smpc_solver</a>.</p>
<h2><a class="anchor" id="pDemo4"></a>
Start simulation:</h2>
<p><div class="fragment"><pre class="fragment">
  
    <span class="keywordflow">for</span>(;;)
    {
        <span class="keywordflow">if</span> (wmg.<a class="code" href="classWMG.html#afa97e1de34aaf70f766aa4965cc34652" title="Forms a preview window.">FormPreviewWindow</a>() == <a class="code" href="group__gWMG__API.html#gga4bb1652524cdb17807ce1b82df68d50aa615ab0e4f617068b4d7347f1f05fba31">WMG_HALT</a>) <span class="comment">// initialize input for QP</span>
        {
            <span class="comment">// not enough time steps left (&lt;15)</span>
            <span class="keywordflow">break</span>;
        }
        <span class="comment">//------------------------------------------------------</span>
</pre></div></p>
<h2><a class="anchor" id="pDemo5"></a>
Solve QP on each iteration of simulation:</h2>
<h3><a class="anchor" id="pDemo51"></a>
Initialize QP</h3>
<p><div class="fragment"><pre class="fragment">

        <span class="comment">// initialize quadratic problem</span>
        solver.set_parameters(
                <span class="comment">// sampling time for each time step [sec.]</span>
                wmg.<a class="code" href="classWMG.html#a951aff39ccdf6b194bcdc8ee7b83755f" title="Preview sampling time.">T</a>,
                <span class="comment">// height of the center of mass divided by gravity for each time step</span>
                wmg.<a class="code" href="classWMG.html#a7df4b6f818bd1bebe6a2994f261bda85" title="h = hCoM/gravity.">h</a>, 
                <span class="comment">// rotation angle for each state relative to the world frame</span>
                wmg.<a class="code" href="classWMG.html#aecb09f9e0fa4b9e5dd1dafe17fad7a44">angle</a>, 
                <span class="comment">// reference values of x coordinate of ZMP</span>
                wmg.<a class="code" href="classWMG.html#a19055d653eec01f23713f8576b17f5d6">zref_x</a>, 
                <span class="comment">// reference values of y coordinate of ZMP</span>
                wmg.<a class="code" href="classWMG.html#a9261037da75150ded329be163ffae710">zref_y</a>, 
                <span class="comment">// array of lower bounds for coordinates of ZMP</span>
                wmg.<a class="code" href="classWMG.html#a0ae585fc064a79f71612a3602a209a7a">lb</a>, 
                <span class="comment">// array of upper bounds for coordinates of ZMP</span>
                wmg.<a class="code" href="classWMG.html#a5aff192ac43f6e2abc81d59c67c97b80">ub</a>);

        solver.form_init_fp (
                <span class="comment">// coordinates of points, that can be used to generate</span>
                <span class="comment">// an initial feasible point</span>
                wmg.<a class="code" href="classWMG.html#a19055d653eec01f23713f8576b17f5d6">zref_x</a>, 
                wmg.<a class="code" href="classWMG.html#a9261037da75150ded329be163ffae710">zref_y</a>, 
                <span class="comment">// current state</span>
                wmg.<a class="code" href="classWMG.html#a831e486340b6774dfe0b1b2d7f52d286" title="Initial state.">X_tilde</a>, 
                <span class="comment">// solution of the optimization problem</span>
                wmg.<a class="code" href="classWMG.html#a801c492c750f587cb1cf873aaec5a96f" title="A chunk of memory allocated for solution.">X</a>);

        <span class="comment">//------------------------------------------------------</span>
</pre></div> See also smpc_solver::init. Note, that the current state must be given after <a class="el" href="pProblemDef.html#pX_tilde">first variable substitution</a>.</p>
<h3><a class="anchor" id="pDemo52"></a>
Solve QP</h3>
<p><div class="fragment"><pre class="fragment">
        <span class="comment">// solve quadratic problem</span>
        solver.solve();
        <span class="comment">//------------------------------------------------------</span>
</pre></div> See also <a class="el" href="classsmpc__solver.html#a180099519887349235c2a90a3839ef71" title="Solve QP problem.">smpc_solver::solve</a>.</p>
<h3><a class="anchor" id="pDemo53"></a>
Obtain the next state</h3>
<p><div class="fragment"><pre class="fragment">
        <span class="comment">// obtain the next state as X_tilde</span>
        solver.get_next_state_tilde (wmg.<a class="code" href="classWMG.html#a831e486340b6774dfe0b1b2d7f52d286" title="Initial state.">X_tilde</a>);
    }

    <span class="keywordflow">return</span> 0;
}
<span class="comment">//---------------------------------------------------------------</span>
</pre></div> See also <a class="el" href="classsmpc__solver.html#a80a01e0024c61b37a7f3f18136808a1f" title="Returns the next state as X_tilde.">smpc_solver::get_next_state_tilde</a>. </p>
</div></div>
<hr class="footer"/><address class="footer"><small>Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
