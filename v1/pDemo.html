<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>A sparse MPC solver for walking motion generation (old version).: A simple demo</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">A sparse MPC solver for walking motion generation (old version).
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">A simple demo </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="pDemo1"></a>
Include headers:</h2>
<p><div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;cmath&gt;</span> <span class="comment">// M_PI</span>


<span class="preprocessor">#include &quot;<a class="code" href="WMG_8h.html">WMG.h</a>&quot;</span>    <span class="comment">// a helper class</span>
<span class="preprocessor">#include &quot;<a class="code" href="smpc__solver_8h.html" title="Interface of the library.">smpc_solver.h</a>&quot;</span>    <span class="comment">// the interface of the library</span>



<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
    <span class="comment">//-----------------------------------------------------------</span>
</pre></div></p>
<h2><a class="anchor" id="pDemo2"></a>
Define footsteps:</h2>
<p><div class="fragment"><pre class="fragment">    <span class="comment">// initialize</span>

    <span class="comment">// WMG is a helper class, which provides data for QP on each</span>
    <span class="comment">// iteration of simulation</span>
    <a class="code" href="classWMG.html" title="Defines the parameters of the Walking Pattern Generator.">WMG</a> wmg(15,     <span class="comment">// size of the preview window</span>
            100);   <span class="comment">// sampling time [ms.]</span>
    <a class="code" href="classsmpc__parameters.html" title="A container for parameters of the SMPC solver.">smpc_parameters</a> param (
            wmg.N,  <span class="comment">// size of the preview window</span>
            0.261); <span class="comment">// height of the center of mass [meter]</span>


    <span class="comment">// Initial double support</span>
    <span class="keywordtype">double</span> d[4] = {0.09 , 0.075, 0.03, 0.025};
    wmg.setFootstepDefaults(2, 1, d);
    wmg.addFootstep(0.0, 0.0, 0.0, <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449ac92a7214504e35546f6bff550f2d07d0">FS_TYPE_DS</a>);
    <span class="comment">// ZMP, CoM are at [0;0]</span>

    <span class="comment">// each step is defined relatively to the previous step</span>
    <span class="keywordtype">double</span> z = 5.0*M_PI/180.0;  <span class="comment">// relative angle</span>
    <span class="keywordtype">double</span> step_x = 0.035;      <span class="comment">// relative X position</span>
    <span class="keywordtype">double</span> step_y = 0.1;        <span class="comment">// relative Y position</span>

    <span class="comment">// all subsequent steps have normal feet size</span>
    d[0] = 0.09;
    d[1] = 0.025;
    d[2] = 0.03;
    d[3] = 0.025;
    <span class="comment">// 2 reference ZMP positions in single support </span>
    <span class="comment">// 1 in double support</span>
    wmg.setFootstepDefaults(2, 1, d);
    wmg.addFootstep(0.0   , -step_y/2, 0.0);
    wmg.addFootstep(step_x,  step_y, z);
    wmg.addFootstep(step_x, -step_y, z);
    wmg.addFootstep(step_x,  step_y, z);
    wmg.addFootstep(step_x, -step_y, z);
    wmg.addFootstep(step_x,  step_y, z);
    wmg.addFootstep(step_x, -step_y, z);
    wmg.addFootstep(step_x,  step_y, 0.0);

    <span class="comment">// here we give many reference points, since otherwise we </span>
    <span class="comment">// would not have enough steps in preview window to reach </span>
    <span class="comment">// the last footsteps</span>
    d[0] = 0.09;
    d[1] = 0.025;
    d[2] = 0.03;
    d[3] = 0.075;
    wmg.setFootstepDefaults(30, 0, d);
    wmg.addFootstep(0.0   , -step_y/2, 0.0, <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449ac92a7214504e35546f6bff550f2d07d0">FS_TYPE_DS</a>);
    <span class="comment">//-----------------------------------------------------------</span>
</pre></div></p>
<h2><a class="anchor" id="pDemo3"></a>
Setup solver:</h2>
<p><div class="fragment"><pre class="fragment">

    <a class="code" href="classsmpc_1_1solver.html" title="API of the sparse MPC solver.">smpc::solver</a> solver(
            wmg.N); <span class="comment">// size of the preview window</span>
                    <span class="comment">// other parameters are optional</span>
    <span class="comment">//-----------------------------------------------------------</span>
</pre></div> The gains are defined <a class="el" href="pProblemDef.html#pGains">here</a>. The default values of optional parameters can be found here: smpc_solver::smpc_solver.</p>
<h2><a class="anchor" id="pDemo4"></a>
Start simulation:</h2>
<p><div class="fragment"><pre class="fragment">
  
    <span class="keywordflow">for</span>(;;)
    {
        <span class="keywordflow">if</span> (wmg.formPreviewWindow(param) == <a class="code" href="group__gWMG__API.html#gga4bb1652524cdb17807ce1b82df68d50aa615ab0e4f617068b4d7347f1f05fba31">WMG_HALT</a>) <span class="comment">// initialize input for QP</span>
        {
            <span class="comment">// not enough time steps left (&lt;15)</span>
            <span class="keywordflow">break</span>;
        }
        <span class="comment">//------------------------------------------------------</span>
</pre></div></p>
<h2><a class="anchor" id="pDemo5"></a>
Solve QP on each iteration of simulation:</h2>
<h3><a class="anchor" id="pDemo51"></a>
Initialize QP</h3>
<p><div class="fragment"><pre class="fragment">

        <span class="comment">// initialize quadratic problem</span>
        solver.set_parameters(
                <span class="comment">// sampling time for each time step [sec.]</span>
                param.T,
                <span class="comment">// height of the center of mass divided by gravity for each time step</span>
                param.h, 
                <span class="comment">// current height of the center of mass divided by gravity</span>
                param.h0, 
                <span class="comment">// rotation angle for each state relative to the world frame</span>
                param.angle, 
                <span class="comment">// reference values of x coordinate of ZMP</span>
                param.fp_x, 
                <span class="comment">// reference values of y coordinate of ZMP</span>
                param.fp_y, 
                <span class="comment">// array of lower bounds for coordinates of ZMP</span>
                param.lb, 
                <span class="comment">// array of upper bounds for coordinates of ZMP</span>
                param.ub);

        solver.form_init_fp (
                <span class="comment">// coordinates of points, that can be used to generate</span>
                <span class="comment">// an initial feasible point</span>
                param.fp_x, 
                param.fp_y, 
                <span class="comment">// initial state</span>
                param.init_state, 
                <span class="comment">// solution of the optimization problem</span>
                param.X);

        <span class="comment">//------------------------------------------------------</span>
</pre></div> See also smpc_solver::init. Note, that the current state must be given after <a class="el" href="pProblemDef.html#pX_tilde">first variable substitution</a>.</p>
<h3><a class="anchor" id="pDemo52"></a>
Solve QP</h3>
<p><div class="fragment"><pre class="fragment">
        <span class="comment">// solve quadratic problem</span>
        solver.solve();
        <span class="comment">//------------------------------------------------------</span>
</pre></div> See also smpc_solver::solve.</p>
<h3><a class="anchor" id="pDemo53"></a>
Obtain the next state</h3>
<p><div class="fragment"><pre class="fragment">
        <span class="comment">// obtain the next state</span>
        param.init_state.get_next_state (solver);
    }

    <span class="keywordflow">return</span> 0;
}
<span class="comment">//---------------------------------------------------------------</span>
</pre></div> See also smpc_solver::get_next_state_tilde. </p>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
