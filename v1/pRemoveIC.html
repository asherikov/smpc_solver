<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>A sparse MPC solver for walking motion generation (old version).: Removing inequality constraints</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">A sparse MPC solver for walking motion generation (old version).
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Removing inequality constraints </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page describes changes in <a class="el" href="pKKT.html">KKT system</a> after removal of inequality constraint from the active set. <br/>
<br/>
</p>
<h2><a class="anchor" id="pCholDown"></a>
Downdate of Cholesky factor</h2>
<p>Imagine, that we have selected an inequality constraint for removal, then corresponding line and column must be removed from matrix <img class="formulaInl" alt="$\mbm{S}$" src="form_47.png"/>. We can represent this by moving these lines to the end and to the right of the matrix using permutation matrix:</p>
<p><img class="formulaInl" alt="$ \mbm{E}_{perm} \mbm{S} \mbm{E}_{perm}^T = \mbm{E}_{perm} \mbm{L} \mbm{L}^T \mbm{E}_{perm}^T = (\mbm{E}_{perm} \mbm{L}) (\mbm{E}_{perm} \mbm{L})^T $" src="form_81.png"/></p>
<p>But matrix <img class="formulaInl" alt="$ \mbm{E}_{perm} \mbm{L} $" src="form_82.png"/> is not lower triangular. We can transform it using Givens rotation matrices (which, obviously, cancel out): </p>
<div class="fragment"><pre class="fragment">    .                 .                     .                 .
    ..                ..                    ..                ..
    ...  -&gt; remove -&gt; .... &lt;  -&gt; Givens  -&gt; ...  -&gt; Givens -&gt; ...
    ....     line     .....&lt;     rotation   .....   rotation  ....
    .....               ^^^
                      these elements 
     L                must be adjusted
</pre></div><p> The rotations are performed in the following way:</p>
<ol type="1">
<li>from two columns, which must be updated, topmost 2x2 matrix is taken;</li>
<li>the rotation matrix is formed in such a way, that this 2x2 matrix becomes diagonal;</li>
<li>the selected two columns are multiplied by the rotation matrix.</li>
</ol>
<p>The Cholesky decomposition is unique: given a positive-definite matrix A, there is only one lower triangular matrix L with strictly positive diagonal entries such that A = L*L'. The algorithm presented above can produce L with negative diagonal entries. If a negative diagonal element is found, the sign of the whole column must be altered after rotation. <br/>
<br/>
</p>
<h2><a class="anchor" id="pRemoveICz"></a>
Downdate of z</h2>
<p>All elements of <img class="formulaInl" alt="$\mbm{z}$" src="form_83.png"/> starting from the position corresponding to the last non-zero (diagonal) element of removed row must be updated.</p>
<p>Consider the following situation (based on formulas derived in section '<a class="el" href="pAddIC.html#pAddICz">Update of z</a>'):</p>
<p><img class="formulaInl" alt="$ \left[ \begin{array}{cccc} \mbm{L} &amp; \mbm{0} &amp; \mbm{0} &amp; \mbm{0} \\ &amp; \mbox{removed line} &amp;&amp;\\ &amp; \mbox{ignored lines} &amp;&amp;\\ \mbm{l}^T &amp; \ell_{rem} &amp; \mbm{l}^T_u&amp; \ell_n \end{array} \right] \left[\begin{array}{c} \mbm{z} \\ z_{rem} \\ \mbm{z}_u \\ z_n \end{array}\right] = \mbm{s} $" src="form_84.png"/></p>
<p>Some lines are not important right now and they are marked as 'ignored'. Elements of <img class="formulaInl" alt="$\mbm{s}$" src="form_71.png"/> are computed on demand and there is no need to alter it. <img class="formulaInl" alt="$\mbm{l}^T_u, \mbm{z}_u$" src="form_85.png"/> must be updated. Vector <img class="formulaInl" alt="$\mbm{l}^T$" src="form_86.png"/> is not affected by update (see section '<a class="el" href="pRemoveIC.html#pCholDown">Downdate of Cholesky factor</a>'). Hence the following number stays constant:</p>
<p><img class="formulaInl" alt="$ z_n \ell_n + \ell_{rem} z_{rem} + \mbm{l}^T_u \mbm{z}_u = s_n - \mbm{l}^T\mbm{z} = z_{n,const} $" src="form_87.png"/></p>
<p>After Cholesky factor was updated we get:</p>
<p><img class="formulaInl" alt="$ \left[ \begin{array}{ccc} \mbm{L} &amp; \mbm{0} &amp; \mbm{0} \\ &amp; \mbox{ignored lines} &amp;\\ \mbm{l}^T &amp; \mbm{l}^T_{u,new}&amp; \ell_{n,new} \end{array} \right] \left[\begin{array}{c} \mbm{z} \\ \mbm{z}_{u,new} \\ z_{n,new} \end{array}\right] = \mbm{s} $" src="form_88.png"/></p>
<p>The new element of vector z can be computed:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ z_{n,new} = \frac{z_{n,const} - \mbm{l}^T_{u,new} \mbm{z}_{u,new} }{\ell_{new}} \]" src="form_89.png"/>
</p>
<p>Note, that computation of new elements <img class="formulaInl" alt="$z_{n,new}$" src="form_90.png"/> must be started from the element corresponding to the first changed line of L and continued towards the end of z. </p>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
