<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>A sparse MPC solver for walking motion generation.: WMG/WMG.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">A sparse MPC solver for walking motion generation.
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">WMG/WMG.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="WMG_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;math.h&gt;</span> <span class="comment">// cos, sin</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="WMG_8h.html">WMG.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="footstep_8h.html">footstep.h</a>&quot;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 
<a name="l00027"></a><a class="code" href="classWMG.html#aca7ea0fd6165db1a75f23c4fba4347f3">00027</a> <a class="code" href="classWMG.html#aca7ea0fd6165db1a75f23c4fba4347f3" title="Initializes a WMG object.">WMG::WMG</a> (
<a name="l00028"></a>00028         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> N_,
<a name="l00029"></a>00029         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> T_, 
<a name="l00030"></a>00030         <span class="keyword">const</span> <span class="keywordtype">double</span> step_height_,
<a name="l00031"></a>00031         <span class="keyword">const</span> <span class="keywordtype">double</span> bezier_weight_1_,
<a name="l00032"></a>00032         <span class="keyword">const</span> <span class="keywordtype">double</span> bezier_weight_2_,
<a name="l00033"></a>00033         <span class="keyword">const</span> <span class="keywordtype">double</span> bezier_inclination_1_,
<a name="l00034"></a>00034         <span class="keyword">const</span> <span class="keywordtype">double</span> bezier_inclination_2_)
<a name="l00035"></a>00035 {
<a name="l00036"></a>00036     <a class="code" href="classWMG.html#aa73c2b69c254fbae2950889a8d72bca6" title="The maximum height, that can be reached by a swing foot.">step_height</a> = step_height_;
<a name="l00037"></a>00037     <a class="code" href="classWMG.html#a923ee807c539e514efa2d86d9844de03" title="Number of iterations in a preview window.">N</a> = N_;
<a name="l00038"></a>00038     <a class="code" href="classWMG.html#aeba3ee738cc30f84d8690aebd6c7c2e6">sampling_period</a> = T_;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040     <a class="code" href="classWMG.html#a08afde28cf03ff4f5766d45ce80b3dcc">T_ms</a> = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[<a class="code" href="classWMG.html#a923ee807c539e514efa2d86d9844de03" title="Number of iterations in a preview window.">N</a>];
<a name="l00041"></a>00041     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classWMG.html#a923ee807c539e514efa2d86d9844de03" title="Number of iterations in a preview window.">N</a>; i++)
<a name="l00042"></a>00042     {
<a name="l00043"></a>00043         <a class="code" href="classWMG.html#a08afde28cf03ff4f5766d45ce80b3dcc">T_ms</a>[i] = 0;
<a name="l00044"></a>00044     }
<a name="l00045"></a>00045     
<a name="l00046"></a>00046 
<a name="l00047"></a>00047     <a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a> = 0;
<a name="l00048"></a>00048     <a class="code" href="classWMG.html#adb4e80c785504e6c43b6ca59edadf423">last_time_decrement</a> = 0;
<a name="l00049"></a>00049     <a class="code" href="classWMG.html#a824a169f37fc3df8a6ceaa55a3e698a9" title="The first step in the current preview window.">first_preview_step</a> = <a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a>;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00053"></a>00053     <a class="code" href="classWMG.html#aa722a357e7b0d26863c9fcb1940b51ca">def_ss_constraint</a>[0] = 0.09;
<a name="l00054"></a>00054     <a class="code" href="classWMG.html#aa722a357e7b0d26863c9fcb1940b51ca">def_ss_constraint</a>[1] = 0.025;
<a name="l00055"></a>00055     <a class="code" href="classWMG.html#aa722a357e7b0d26863c9fcb1940b51ca">def_ss_constraint</a>[2] = 0.03;
<a name="l00056"></a>00056     <a class="code" href="classWMG.html#aa722a357e7b0d26863c9fcb1940b51ca">def_ss_constraint</a>[3] = 0.025;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058     <a class="code" href="classWMG.html#a3c8c594db7e76a4a0b4feb013ad3cfad">def_auto_ds_constraint</a>[0] = 0.07;
<a name="l00059"></a>00059     <a class="code" href="classWMG.html#a3c8c594db7e76a4a0b4feb013ad3cfad">def_auto_ds_constraint</a>[1] = 0.025;
<a name="l00060"></a>00060     <a class="code" href="classWMG.html#a3c8c594db7e76a4a0b4feb013ad3cfad">def_auto_ds_constraint</a>[2] = 0.025;
<a name="l00061"></a>00061     <a class="code" href="classWMG.html#a3c8c594db7e76a4a0b4feb013ad3cfad">def_auto_ds_constraint</a>[3] = 0.025;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[0] = <a class="code" href="classWMG.html#aa722a357e7b0d26863c9fcb1940b51ca">def_ss_constraint</a>[0];
<a name="l00064"></a>00064     <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[1] = <a class="code" href="classWMG.html#aa722a357e7b0d26863c9fcb1940b51ca">def_ss_constraint</a>[1];
<a name="l00065"></a>00065     <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[2] = <a class="code" href="classWMG.html#aa722a357e7b0d26863c9fcb1940b51ca">def_ss_constraint</a>[2];
<a name="l00066"></a>00066     <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[3] = <a class="code" href="classWMG.html#aa722a357e7b0d26863c9fcb1940b51ca">def_ss_constraint</a>[3];
<a name="l00067"></a>00067 
<a name="l00068"></a>00068     <a class="code" href="classWMG.html#a58e51214c674db9bb2d680558d38b520">def_time_ms</a> = 400;
<a name="l00069"></a>00069     <a class="code" href="classWMG.html#a6a1d2969003c2a1a5ab2b6776fcccf5c">ds_time_ms</a> = 0;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071     <a class="code" href="classWMG.html#ae00d3839fb167823358529ec03b55785">bezier_weight_1</a> = bezier_weight_1_;
<a name="l00072"></a>00072     <a class="code" href="classWMG.html#a942fd5fb0aad8e74bff7d80844bb8652">bezier_weight_2</a> = bezier_weight_2_;
<a name="l00073"></a>00073     <a class="code" href="classWMG.html#a457a29a6e3e86091798863a8733654a9">bezier_inclination_1</a> = bezier_inclination_1_;
<a name="l00074"></a>00074     <a class="code" href="classWMG.html#ab0f4120aab9dc08ec6b16b2ba7557a13">bezier_inclination_2</a> = bezier_inclination_2_;
<a name="l00075"></a>00075 }
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 
<a name="l00079"></a><a class="code" href="classWMG.html#a9c401ba3687308b65cffbff340142b3f">00079</a> <a class="code" href="classWMG.html#a9c401ba3687308b65cffbff340142b3f" title="Default destructor.">WMG::~WMG</a>()
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081     <span class="keywordflow">if</span> (<a class="code" href="classWMG.html#a08afde28cf03ff4f5766d45ce80b3dcc">T_ms</a> != NULL)
<a name="l00082"></a>00082     {
<a name="l00083"></a>00083         <span class="keyword">delete</span> <a class="code" href="classWMG.html#a08afde28cf03ff4f5766d45ce80b3dcc">T_ms</a>;
<a name="l00084"></a>00084     }
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00098"></a><a class="code" href="classWMG.html#a95e85052e43f64c5d2f7dde39f2588f6">00098</a> <span class="keywordtype">void</span> <a class="code" href="classWMG.html#a95e85052e43f64c5d2f7dde39f2588f6" title="Set default parameters of footsteps.">WMG::setFootstepDefaults</a>(
<a name="l00099"></a>00099         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> def_num_, 
<a name="l00100"></a>00100         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ds_num_,
<a name="l00101"></a>00101         <span class="keyword">const</span> <span class="keywordtype">double</span> *constraints) 
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103     <span class="keywordflow">if</span> (constraints != NULL)
<a name="l00104"></a>00104     {
<a name="l00105"></a>00105         <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[0] = constraints[0];
<a name="l00106"></a>00106         <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[1] = constraints[1];
<a name="l00107"></a>00107         <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[2] = constraints[2];
<a name="l00108"></a>00108         <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[3] = constraints[3];
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     <a class="code" href="classWMG.html#a58e51214c674db9bb2d680558d38b520">def_time_ms</a> = def_num_ * <a class="code" href="classWMG.html#aeba3ee738cc30f84d8690aebd6c7c2e6">sampling_period</a>;
<a name="l00112"></a>00112     <a class="code" href="classWMG.html#a6a1d2969003c2a1a5ab2b6776fcccf5c">ds_time_ms</a>  = <a class="code" href="classWMG.html#aeba3ee738cc30f84d8690aebd6c7c2e6">sampling_period</a>; 
<a name="l00113"></a>00113     <a class="code" href="classWMG.html#a73f6a84e442ae0546c1f53ec7f3f877c">ds_num</a>      = ds_num_;
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 
<a name="l00126"></a><a class="code" href="classWMG.html#af4a67e60426c8d0d59488b7ccb78e602">00126</a> <span class="keywordtype">void</span> <a class="code" href="classWMG.html#a95e85052e43f64c5d2f7dde39f2588f6" title="Set default parameters of footsteps.">WMG::setFootstepDefaults</a>(
<a name="l00127"></a>00127         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> def_time_ms_, 
<a name="l00128"></a>00128         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ds_time_ms_, 
<a name="l00129"></a>00129         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ds_num_,
<a name="l00130"></a>00130         <span class="keyword">const</span> <span class="keywordtype">double</span> *constraints) 
<a name="l00131"></a>00131 {
<a name="l00132"></a>00132     <span class="keywordflow">if</span> (constraints != NULL)
<a name="l00133"></a>00133     {
<a name="l00134"></a>00134         <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[0] = constraints[0];
<a name="l00135"></a>00135         <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[1] = constraints[1];
<a name="l00136"></a>00136         <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[2] = constraints[2];
<a name="l00137"></a>00137         <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[3] = constraints[3];
<a name="l00138"></a>00138     }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <a class="code" href="classWMG.html#a58e51214c674db9bb2d680558d38b520">def_time_ms</a> = def_time_ms_;
<a name="l00141"></a>00141     <a class="code" href="classWMG.html#a6a1d2969003c2a1a5ab2b6776fcccf5c">ds_time_ms</a>  = ds_time_ms_; 
<a name="l00142"></a>00142     <a class="code" href="classWMG.html#a73f6a84e442ae0546c1f53ec7f3f877c">ds_num</a>      = ds_num_;
<a name="l00143"></a>00143 }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 
<a name="l00157"></a><a class="code" href="classWMG.html#a74bae72edfa4402ba19f360e5b1582dc">00157</a> <span class="keywordtype">void</span> <a class="code" href="classWMG.html#a74bae72edfa4402ba19f360e5b1582dc" title="Adds a footstep to FS.">WMG::addFootstep</a>(
<a name="l00158"></a>00158         <span class="keyword">const</span> <span class="keywordtype">double</span> x_relative, 
<a name="l00159"></a>00159         <span class="keyword">const</span> <span class="keywordtype">double</span> y_relative, 
<a name="l00160"></a>00160         <span class="keyword">const</span> <span class="keywordtype">double</span> angle_relative, 
<a name="l00161"></a>00161         <a class="code" href="group__gWMG__API.html#ga45147e528b9243fa8842d38163498449">fs_type</a> type)
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163     Transform&lt;double, 3&gt;    posture (Translation&lt;double, 3&gt;(x_relative, y_relative, 0.0));
<a name="l00164"></a>00164     Vector3d    zref_offset ((<a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[0] - <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>[2])/2, 0.0, 0.0);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <span class="keywordflow">if</span> (<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.size() == 0)
<a name="l00168"></a>00168     {
<a name="l00169"></a>00169         <span class="comment">// this is the first (&quot;virtual&quot;) step.</span>
<a name="l00170"></a>00170         <span class="keywordflow">if</span> (type == <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449a8fde2d0cdecdd9eb8caf0bede2665815">FS_TYPE_AUTO</a>)
<a name="l00171"></a>00171         {
<a name="l00172"></a>00172             type = <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449ac92a7214504e35546f6bff550f2d07d0">FS_TYPE_DS</a>;
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         posture *= AngleAxisd(angle_relative, Vector3d::UnitZ());
<a name="l00176"></a>00176         <span class="comment">// offset is the absolute position here.</span>
<a name="l00177"></a>00177         Vector3d zref_abs = posture * zref_offset;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.push_back(
<a name="l00180"></a>00180                 <a class="code" href="classfootstep.html" title="Defines a footstep.">footstep</a>(
<a name="l00181"></a>00181                     angle_relative, 
<a name="l00182"></a>00182                     posture,
<a name="l00183"></a>00183                     zref_abs,
<a name="l00184"></a>00184                     <a class="code" href="classWMG.html#a58e51214c674db9bb2d680558d38b520">def_time_ms</a>, 
<a name="l00185"></a>00185                     type,
<a name="l00186"></a>00186                     <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>));
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188     <span class="keywordflow">else</span>
<a name="l00189"></a>00189     {
<a name="l00190"></a>00190         <span class="comment">// determine type of the step</span>
<a name="l00191"></a>00191         <span class="keywordflow">if</span> (type == <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449a8fde2d0cdecdd9eb8caf0bede2665815">FS_TYPE_AUTO</a>)
<a name="l00192"></a>00192         {
<a name="l00193"></a>00193             <span class="keywordflow">switch</span> (<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[<a class="code" href="classWMG.html#a02edb351fa39c4530b6d4c9e8aa29311" title="Returns index of the previous SS.">getPrevSS</a>(<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.size())].type)
<a name="l00194"></a>00194             {
<a name="l00195"></a>00195                 <span class="keywordflow">case</span> <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449a4520b925caf066a47b733e827647cc55">FS_TYPE_SS_L</a>:
<a name="l00196"></a>00196                     type = <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449a961ddc0fabfa0f842b7296b9413e644e">FS_TYPE_SS_R</a>;
<a name="l00197"></a>00197                     <span class="keywordflow">break</span>;
<a name="l00198"></a>00198                 <span class="keywordflow">case</span> <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449a961ddc0fabfa0f842b7296b9413e644e">FS_TYPE_SS_R</a>:
<a name="l00199"></a>00199                     type = <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449a4520b925caf066a47b733e827647cc55">FS_TYPE_SS_L</a>;
<a name="l00200"></a>00200                     <span class="keywordflow">break</span>;
<a name="l00201"></a>00201                 <span class="keywordflow">case</span> <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449ac92a7214504e35546f6bff550f2d07d0">FS_TYPE_DS</a>:
<a name="l00202"></a>00202                 <span class="keywordflow">default</span>:
<a name="l00203"></a>00203                     type = <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449a961ddc0fabfa0f842b7296b9413e644e">FS_TYPE_SS_R</a>;
<a name="l00204"></a>00204                     <span class="keywordflow">break</span>;
<a name="l00205"></a>00205             }
<a name="l00206"></a>00206         }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208         <span class="comment">// Position of the next step</span>
<a name="l00209"></a>00209         posture = (*<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.back().posture) * posture * AngleAxisd(angle_relative, Vector3d::UnitZ());
<a name="l00210"></a>00210 
<a name="l00211"></a>00211         <span class="keywordtype">double</span> prev_a = <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.back().angle;
<a name="l00212"></a>00212         <span class="keywordtype">double</span> next_a = prev_a + angle_relative;
<a name="l00213"></a>00213         Vector3d next_zref = posture * zref_offset;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         <span class="comment">// Add double support constraints that lie between the</span>
<a name="l00217"></a>00217         <span class="comment">// newly added step and the previous step</span>
<a name="l00218"></a>00218         <span class="keywordtype">double</span> theta = (double) 1/(<a class="code" href="classWMG.html#a73f6a84e442ae0546c1f53ec7f3f877c">ds_num</a> + 1);
<a name="l00219"></a>00219         <span class="keywordtype">double</span> angle_shift = angle_relative * theta;
<a name="l00220"></a>00220         <span class="keywordtype">double</span> x_shift = theta*x_relative;
<a name="l00221"></a>00221         <span class="keywordtype">double</span> y_shift = theta*y_relative;
<a name="l00222"></a>00222         Vector3d *ds_zref = &amp;<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.back().ZMPref;
<a name="l00223"></a>00223         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classWMG.html#a73f6a84e442ae0546c1f53ec7f3f877c">ds_num</a>; i++)
<a name="l00224"></a>00224         {
<a name="l00225"></a>00225             Transform&lt;double, 3&gt; ds_posture = (*<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.back().posture) 
<a name="l00226"></a>00226                        * Translation&lt;double, 3&gt;(x_shift, y_shift, 0.0)
<a name="l00227"></a>00227                        * AngleAxisd(angle_shift, Vector3d::UnitZ());
<a name="l00228"></a>00228 
<a name="l00229"></a>00229             <span class="keywordflow">if</span> (i == ds_num / 2)
<a name="l00230"></a>00230             {
<a name="l00231"></a>00231                 ds_zref = &amp;next_zref;
<a name="l00232"></a>00232             }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234             <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.push_back(
<a name="l00235"></a>00235                     <a class="code" href="classfootstep.html" title="Defines a footstep.">footstep</a>(
<a name="l00236"></a>00236                         <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.back().angle + angle_shift,
<a name="l00237"></a>00237                         ds_posture,
<a name="l00238"></a>00238                         *ds_zref,
<a name="l00239"></a>00239                         <a class="code" href="classWMG.html#a6a1d2969003c2a1a5ab2b6776fcccf5c">ds_time_ms</a>, 
<a name="l00240"></a>00240                         <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449ac92a7214504e35546f6bff550f2d07d0">FS_TYPE_DS</a>,
<a name="l00241"></a>00241                         <a class="code" href="classWMG.html#a3c8c594db7e76a4a0b4feb013ad3cfad">def_auto_ds_constraint</a>));
<a name="l00242"></a>00242         }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         <span class="comment">// add the new step</span>
<a name="l00246"></a>00246         <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.push_back(
<a name="l00247"></a>00247                 <a class="code" href="classfootstep.html" title="Defines a footstep.">footstep</a>(
<a name="l00248"></a>00248                     next_a, 
<a name="l00249"></a>00249                     posture, 
<a name="l00250"></a>00250                     next_zref,
<a name="l00251"></a>00251                     <a class="code" href="classWMG.html#a58e51214c674db9bb2d680558d38b520">def_time_ms</a>, 
<a name="l00252"></a>00252                     type,
<a name="l00253"></a>00253                     <a class="code" href="classWMG.html#aeae0e43b50428938f2343ae65f43a8ae">addstep_constraint</a>));
<a name="l00254"></a>00254     }    
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 
<a name="l00273"></a><a class="code" href="classWMG.html#a631e75e8be9136e382942db838a33490">00273</a> <span class="keywordtype">void</span> <a class="code" href="classWMG.html#a631e75e8be9136e382942db838a33490" title="Determine position and orientation of feet.">WMG::getFeetPositions</a> (
<a name="l00274"></a>00274         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> shift_from_current_ms,
<a name="l00275"></a>00275         <span class="keywordtype">double</span> *left_foot_pos,
<a name="l00276"></a>00276         <span class="keywordtype">double</span> *right_foot_pos)
<a name="l00277"></a>00277 {
<a name="l00278"></a>00278     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> support_number = <a class="code" href="classWMG.html#a824a169f37fc3df8a6ceaa55a3e698a9" title="The first step in the current preview window.">first_preview_step</a>;
<a name="l00279"></a>00279     <span class="comment">// formPreviewWindow() have already decremented the time</span>
<a name="l00280"></a>00280     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> step_time_left = <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[support_number].time_left + <a class="code" href="classWMG.html#adb4e80c785504e6c43b6ca59edadf423">last_time_decrement</a>;
<a name="l00281"></a>00281     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> shift_ms = shift_from_current_ms;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     <span class="keywordflow">while</span> (shift_ms &gt; step_time_left)
<a name="l00285"></a>00285     {
<a name="l00286"></a>00286         shift_ms -= step_time_left;
<a name="l00287"></a>00287         ++support_number;
<a name="l00288"></a>00288         <span class="keywordflow">if</span> (support_number &gt;= <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.size())
<a name="l00289"></a>00289         {
<a name="l00290"></a>00290             <span class="keywordflow">return</span>;
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292         step_time_left = <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[support_number].time_left;
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 
<a name="l00296"></a>00296     <span class="keywordflow">if</span> (<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[support_number].type == <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449ac92a7214504e35546f6bff550f2d07d0">FS_TYPE_DS</a>)
<a name="l00297"></a>00297     {
<a name="l00298"></a>00298         <a class="code" href="classWMG.html#aa3546c1fbf97263e4542e14015004f2e" title="Determine position and orientation of feet in DS.">getDSFeetPositions</a> (support_number, left_foot_pos, right_foot_pos);
<a name="l00299"></a>00299     }
<a name="l00300"></a>00300     <span class="keywordflow">else</span>
<a name="l00301"></a>00301     {
<a name="l00302"></a>00302         <span class="keywordtype">double</span> theta = (double) 
<a name="l00303"></a>00303             ((<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[support_number].time_period - step_time_left) + shift_ms) 
<a name="l00304"></a>00304             / <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[support_number].time_period;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306         <a class="code" href="classWMG.html#a05155acdab8732f036fc88d80f8b08cc" title="Determine position and orientation of feet (using cubic Bezier curves)">getSSFeetPositionsBezier</a> (
<a name="l00307"></a>00307                 support_number,
<a name="l00308"></a>00308                 theta,
<a name="l00309"></a>00309                 left_foot_pos, 
<a name="l00310"></a>00310                 right_foot_pos);
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 
<a name="l00321"></a><a class="code" href="classWMG.html#a6c99fd7d1402125cd58563fd6fb1d691">00321</a> <span class="keywordtype">bool</span> <a class="code" href="classWMG.html#a6c99fd7d1402125cd58563fd6fb1d691" title="Checks if the support foot switch is needed.">WMG::isSupportSwitchNeeded</a> ()
<a name="l00322"></a>00322 {
<a name="l00323"></a>00323     <span class="comment">// current_step_number is the number of step, which will</span>
<a name="l00324"></a>00324     <span class="comment">// be the first in the preview window, when formPreviewWindow()</span>
<a name="l00325"></a>00325     <span class="comment">// is called.</span>
<a name="l00326"></a>00326     <span class="keywordflow">if</span> (<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[<a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a>].type == <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449ac92a7214504e35546f6bff550f2d07d0">FS_TYPE_DS</a>)
<a name="l00327"></a>00327     {
<a name="l00328"></a>00328         <span class="keywordflow">return</span> (<span class="keyword">false</span>);
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330     <span class="keywordflow">else</span> <span class="comment">// single support</span>
<a name="l00331"></a>00331     {
<a name="l00332"></a>00332         <span class="keywordflow">if</span> (<span class="comment">// if we are not in the initial support</span>
<a name="l00333"></a>00333             (<a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a> != 0) &amp;&amp;
<a name="l00334"></a>00334             <span class="comment">// this is the first iteration in SS</span>
<a name="l00335"></a>00335             (<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[<a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a>].time_period == <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[<a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a>].time_left) &amp;&amp;
<a name="l00336"></a>00336             <span class="comment">// the previous SS was different</span>
<a name="l00337"></a>00337             (<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[<a class="code" href="classWMG.html#a02edb351fa39c4530b6d4c9e8aa29311" title="Returns index of the previous SS.">getPrevSS</a>(<a class="code" href="classWMG.html#a824a169f37fc3df8a6ceaa55a3e698a9" title="The first step in the current preview window.">first_preview_step</a>)].type != <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[<a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a>].type))
<a name="l00338"></a>00338         {
<a name="l00339"></a>00339             <span class="keywordflow">return</span> (<span class="keyword">true</span>);
<a name="l00340"></a>00340         }
<a name="l00341"></a>00341     }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343     <span class="keywordflow">return</span> (<span class="keyword">false</span>);
<a name="l00344"></a>00344 }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 
<a name="l00356"></a><a class="code" href="classWMG.html#a96d65fb431a5a347c769de939f18acd9">00356</a> <span class="keywordtype">void</span> <a class="code" href="classWMG.html#a96d65fb431a5a347c769de939f18acd9" title="Changes position of the next SS.">WMG::changeNextSSPosition</a> (<span class="keyword">const</span> <span class="keywordtype">double</span>* posture, <span class="keyword">const</span> <span class="keywordtype">bool</span> zero_z_coordinate)
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358     <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[<a class="code" href="classWMG.html#a75acb9eff024d564eed72f552d0f3012" title="Returns index of the next SS.">getNextSS</a>(<a class="code" href="classWMG.html#a824a169f37fc3df8a6ceaa55a3e698a9" title="The first step in the current preview window.">first_preview_step</a>)].changePosture(posture, zero_z_coordinate);
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 
<a name="l00362"></a>00362 
<a name="l00368"></a><a class="code" href="classWMG.html#ac9fb2acae0b398c5ad1fb9c5109b0b1e">00368</a> <a class="code" href="group__gWMG__API.html#ga4bb1652524cdb17807ce1b82df68d50a">WMGret</a> <a class="code" href="classWMG.html#ac9fb2acae0b398c5ad1fb9c5109b0b1e" title="Forms a preview window.">WMG::formPreviewWindow</a>(<a class="code" href="classsmpc__parameters.html" title="A container for parameters of the SMPC solver.">smpc_parameters</a> &amp; par)
<a name="l00369"></a>00369 {
<a name="l00370"></a>00370     <a class="code" href="group__gWMG__API.html#ga4bb1652524cdb17807ce1b82df68d50a">WMGret</a> retval = <a class="code" href="group__gWMG__API.html#gga4bb1652524cdb17807ce1b82df68d50aab15bed358ba0a63210097a1a77920b5b">WMG_OK</a>;
<a name="l00371"></a>00371     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> win_step_num = <a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a>;
<a name="l00372"></a>00372     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> step_time_left = <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[win_step_num].time_left;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classWMG.html#a923ee807c539e514efa2d86d9844de03" title="Number of iterations in a preview window.">N</a>;)
<a name="l00376"></a>00376     {
<a name="l00377"></a>00377         <span class="keywordflow">if</span> (step_time_left &gt; 0)
<a name="l00378"></a>00378         {
<a name="l00379"></a>00379             par.<a class="code" href="classsmpc__parameters.html#aa4ce6a361db1705b0d8203ebaa5a6fa0" title="initial h">angle</a>[i] = <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[win_step_num].angle;
<a name="l00380"></a>00380 
<a name="l00381"></a>00381             par.<a class="code" href="classsmpc__parameters.html#a84ca776cec9fb1d557b9650f9819fcbf" title="Coordinates of N points satisfying constraints,.">fp_x</a>[i] = <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[win_step_num].x();
<a name="l00382"></a>00382             par.<a class="code" href="classsmpc__parameters.html#a8874826f7fb3d129acec92741f6115ac" title="Coordinates of N points satisfying constraints,.">fp_y</a>[i] = <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[win_step_num].y();
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 
<a name="l00385"></a>00385             <span class="comment">// ZMP reference coordinates</span>
<a name="l00386"></a>00386             par.<a class="code" href="classsmpc__parameters.html#aa1521926381f147be881277f0e3edea8" title="N reference coordinates of ZMP.">zref_x</a>[i] = <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[win_step_num].ZMPref.x();
<a name="l00387"></a>00387             par.<a class="code" href="classsmpc__parameters.html#afa66d8ed85161c1794062ebebc780625" title="N reference coordinates of ZMP.">zref_y</a>[i] = <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[win_step_num].ZMPref.y();
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 
<a name="l00390"></a>00390             par.<a class="code" href="classsmpc__parameters.html#a1a942c7988bf5f76c6390fb2cf8e32c2" title="2*N bounds for coordinates of ZMP position.">lb</a>[i*2] = -<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[win_step_num].d[2];
<a name="l00391"></a>00391             par.<a class="code" href="classsmpc__parameters.html#af9624227493a426cfb9ff5751bf28680" title="2*N bounds for coordinates of ZMP position.">ub</a>[i*2] = <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[win_step_num].d[0];
<a name="l00392"></a>00392 
<a name="l00393"></a>00393             par.<a class="code" href="classsmpc__parameters.html#a1a942c7988bf5f76c6390fb2cf8e32c2" title="2*N bounds for coordinates of ZMP position.">lb</a>[i*2 + 1] = -<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[win_step_num].d[3];
<a name="l00394"></a>00394             par.<a class="code" href="classsmpc__parameters.html#af9624227493a426cfb9ff5751bf28680" title="2*N bounds for coordinates of ZMP position.">ub</a>[i*2 + 1] = <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[win_step_num].d[1];
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 
<a name="l00397"></a>00397             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> step_len_ms;
<a name="l00398"></a>00398             <span class="keywordflow">if</span> (<a class="code" href="classWMG.html#a08afde28cf03ff4f5766d45ce80b3dcc">T_ms</a>[i] == 0)
<a name="l00399"></a>00399             {
<a name="l00400"></a>00400                 <span class="keywordflow">if</span> (<a class="code" href="classWMG.html#aeba3ee738cc30f84d8690aebd6c7c2e6">sampling_period</a> &gt; step_time_left) 
<a name="l00401"></a>00401                 {
<a name="l00402"></a>00402                     step_len_ms = step_time_left;
<a name="l00403"></a>00403                 }
<a name="l00404"></a>00404                 <span class="keywordflow">else</span>
<a name="l00405"></a>00405                 {
<a name="l00406"></a>00406                     step_len_ms = <a class="code" href="classWMG.html#aeba3ee738cc30f84d8690aebd6c7c2e6">sampling_period</a>;
<a name="l00407"></a>00407                 }
<a name="l00408"></a>00408             }
<a name="l00409"></a>00409             <span class="keywordflow">else</span>
<a name="l00410"></a>00410             {
<a name="l00411"></a>00411                 <span class="keywordflow">if</span> (<a class="code" href="classWMG.html#a08afde28cf03ff4f5766d45ce80b3dcc">T_ms</a>[i] &gt; step_time_left) 
<a name="l00412"></a>00412                 {
<a name="l00413"></a>00413                     retval = <a class="code" href="group__gWMG__API.html#gga4bb1652524cdb17807ce1b82df68d50aa615ab0e4f617068b4d7347f1f05fba31">WMG_HALT</a>;
<a name="l00414"></a>00414                     <span class="keywordflow">break</span>;
<a name="l00415"></a>00415                 }
<a name="l00416"></a>00416                 step_len_ms = <a class="code" href="classWMG.html#a08afde28cf03ff4f5766d45ce80b3dcc">T_ms</a>[i];
<a name="l00417"></a>00417             }
<a name="l00418"></a>00418             par.<a class="code" href="classsmpc__parameters.html#ad0bc7d4a82cda8ad8460c16b6560ed95" title="Norm of the acceleration due to gravity.">T</a>[i] = (double) step_len_ms / 1000;
<a name="l00419"></a>00419             step_time_left -= step_len_ms;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421             <span class="keywordflow">if</span> (i == 0)
<a name="l00422"></a>00422             {
<a name="l00423"></a>00423                 <a class="code" href="classWMG.html#adb4e80c785504e6c43b6ca59edadf423">last_time_decrement</a> = step_len_ms;
<a name="l00424"></a>00424             }
<a name="l00425"></a>00425             i++;
<a name="l00426"></a>00426         }
<a name="l00427"></a>00427         <span class="keywordflow">else</span>
<a name="l00428"></a>00428         {
<a name="l00429"></a>00429             win_step_num++;
<a name="l00430"></a>00430             <span class="keywordflow">if</span> (win_step_num == <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.size())
<a name="l00431"></a>00431             {
<a name="l00432"></a>00432                 retval = <a class="code" href="group__gWMG__API.html#gga4bb1652524cdb17807ce1b82df68d50aa615ab0e4f617068b4d7347f1f05fba31">WMG_HALT</a>;
<a name="l00433"></a>00433                 <span class="keywordflow">break</span>;
<a name="l00434"></a>00434             }
<a name="l00435"></a>00435             step_time_left = <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[win_step_num].time_left;
<a name="l00436"></a>00436         }
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 
<a name="l00440"></a>00440     <span class="keywordflow">if</span> (retval == <a class="code" href="group__gWMG__API.html#gga4bb1652524cdb17807ce1b82df68d50aab15bed358ba0a63210097a1a77920b5b">WMG_OK</a>)
<a name="l00441"></a>00441     {
<a name="l00442"></a>00442         <span class="keywordflow">while</span> (<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[<a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a>].time_left == 0)
<a name="l00443"></a>00443         {
<a name="l00444"></a>00444             <a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a>++;
<a name="l00445"></a>00445         }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447         <a class="code" href="classWMG.html#a824a169f37fc3df8a6ceaa55a3e698a9" title="The first step in the current preview window.">first_preview_step</a> = <a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a>;
<a name="l00448"></a>00448         <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[<a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a>].time_left -= <a class="code" href="classWMG.html#adb4e80c785504e6c43b6ca59edadf423">last_time_decrement</a>;
<a name="l00449"></a>00449         <span class="keywordflow">if</span> (<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[<a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a>].time_left == 0)
<a name="l00450"></a>00450         {
<a name="l00451"></a>00451             <a class="code" href="classWMG.html#a6770fc44d46e4fdda9ad584c02516ce5">current_step_number</a>++;
<a name="l00452"></a>00452         }
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <span class="keywordflow">return</span> (retval);
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 
<a name="l00459"></a>00459 
<a name="l00467"></a><a class="code" href="classWMG.html#a2033e4afd56590aff6df834613993c82">00467</a> <span class="keywordtype">void</span> <a class="code" href="classWMG.html#a2033e4afd56590aff6df834613993c82" title="Outputs the footsteps in FS to a file, that can be executed in Matlab/Octave to get a figure of the s...">WMG::FS2file</a>(<span class="keyword">const</span> std::string filename, <span class="keyword">const</span> <span class="keywordtype">bool</span> plot_ds)
<a name="l00468"></a>00468 {
<a name="l00469"></a>00469     
<a name="l00470"></a>00470     FILE *file_op = fopen(filename.c_str(), <span class="stringliteral">&quot;w&quot;</span>);
<a name="l00471"></a>00471     
<a name="l00472"></a>00472     <span class="keywordflow">if</span>(!file_op)
<a name="l00473"></a>00473     {
<a name="l00474"></a>00474         fprintf(stderr, <span class="stringliteral">&quot;Cannot open file (for writing)\n&quot;</span>);
<a name="l00475"></a>00475         <span class="keywordflow">return</span>;
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477     
<a name="l00478"></a>00478     fprintf(file_op,<span class="stringliteral">&quot;%%\n%% Footsteps generated using the c++ version of the WMG\n%%\n\n&quot;</span>);
<a name="l00479"></a>00479     fprintf(file_op,<span class="stringliteral">&quot;cla;\n&quot;</span>);
<a name="l00480"></a>00480     fprintf(file_op,<span class="stringliteral">&quot;clear FS;\n\n&quot;</span>);
<a name="l00481"></a>00481     
<a name="l00482"></a>00482     <span class="keywordtype">int</span> i;
<a name="l00483"></a>00483     <span class="keywordflow">for</span> (i=0; i&lt; (int) <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.size(); i++ )
<a name="l00484"></a>00484     {
<a name="l00485"></a>00485         <span class="keywordflow">if</span> ((plot_ds) || (<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].type != <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449ac92a7214504e35546f6bff550f2d07d0">FS_TYPE_DS</a>))
<a name="l00486"></a>00486         {
<a name="l00487"></a>00487             fprintf(file_op, <span class="stringliteral">&quot;FS(%i).a = %f;\nFS(%i).p = [%f;%f];\nFS(%i).d = [%f;%f;%f;%f];\n&quot;</span>, 
<a name="l00488"></a>00488                     i+1, <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].angle, 
<a name="l00489"></a>00489                     i+1, <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].x(), <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].y(), 
<a name="l00490"></a>00490                     i+1, <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].d[0], <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].d[1], <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].d[2], <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].d[3]);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492             fprintf(file_op, <span class="stringliteral">&quot;FS(%i).D = [%f %f;%f %f;%f %f;%f %f];\n&quot;</span>, 
<a name="l00493"></a>00493                     i+1, <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].D[0], <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].D[4],
<a name="l00494"></a>00494                          <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].D[1], <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].D[5],
<a name="l00495"></a>00495                          <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].D[2], <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].D[6],
<a name="l00496"></a>00496                          <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].D[3], <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].D[7]); 
<a name="l00497"></a>00497 
<a name="l00498"></a>00498             fprintf(file_op, <span class="stringliteral">&quot;FS(%i).v = [%f %f; %f %f; %f %f; %f %f; %f %f];\n&quot;</span>, 
<a name="l00499"></a>00499                     i+1, <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].vert(0,0), <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].vert(0,1), 
<a name="l00500"></a>00500                          <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].vert(1,0), <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].vert(1,1), 
<a name="l00501"></a>00501                          <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].vert(2,0), <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].vert(2,1), 
<a name="l00502"></a>00502                          <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].vert(3,0), <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].vert(3,1), 
<a name="l00503"></a>00503                          <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].vert(0,0), <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].vert(0,1));
<a name="l00504"></a>00504 
<a name="l00505"></a>00505             <span class="keywordflow">if</span> (<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].type == <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449ac92a7214504e35546f6bff550f2d07d0">FS_TYPE_DS</a>)
<a name="l00506"></a>00506             {
<a name="l00507"></a>00507                 fprintf(file_op, <span class="stringliteral">&quot;FS(%i).type = 1;\n\n&quot;</span>, i+1);
<a name="l00508"></a>00508             }
<a name="l00509"></a>00509             <span class="keywordflow">if</span> ((<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].type == <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449a4520b925caf066a47b733e827647cc55">FS_TYPE_SS_L</a>) || (<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].type == <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449a961ddc0fabfa0f842b7296b9413e644e">FS_TYPE_SS_R</a>))
<a name="l00510"></a>00510             {
<a name="l00511"></a>00511                 fprintf(file_op, <span class="stringliteral">&quot;FS(%i).type = 2;\n\n&quot;</span>, i+1);
<a name="l00512"></a>00512             }
<a name="l00513"></a>00513         }
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     fprintf(file_op,<span class="stringliteral">&quot;hold on\n&quot;</span>);    
<a name="l00517"></a>00517     fprintf(file_op,<span class="stringliteral">&quot;for i=1:length(FS)\n&quot;</span>);
<a name="l00518"></a>00518     fprintf(file_op,<span class="stringliteral">&quot;    if FS(i).type == 1;\n&quot;</span>);
<a name="l00519"></a>00519     fprintf(file_op,<span class="stringliteral">&quot;        plot (FS(i).p(1),FS(i).p(2),&#39;gs&#39;,&#39;MarkerFaceColor&#39;,&#39;r&#39;,&#39;MarkerSize&#39;,2)\n&quot;</span>);
<a name="l00520"></a>00520     fprintf(file_op,<span class="stringliteral">&quot;        plot (FS(i).v(:,1), FS(i).v(:,2), &#39;c&#39;);\n&quot;</span>);
<a name="l00521"></a>00521     fprintf(file_op,<span class="stringliteral">&quot;    end\n&quot;</span>);
<a name="l00522"></a>00522     fprintf(file_op,<span class="stringliteral">&quot;    if FS(i).type == 2;\n&quot;</span>);
<a name="l00523"></a>00523     fprintf(file_op,<span class="stringliteral">&quot;        plot (FS(i).p(1),FS(i).p(2),&#39;gs&#39;,&#39;MarkerFaceColor&#39;,&#39;g&#39;,&#39;MarkerSize&#39;,4)\n&quot;</span>);
<a name="l00524"></a>00524     fprintf(file_op,<span class="stringliteral">&quot;        plot (FS(i).v(:,1), FS(i).v(:,2), &#39;r&#39;);\n&quot;</span>);
<a name="l00525"></a>00525     fprintf(file_op,<span class="stringliteral">&quot;    end\n&quot;</span>);
<a name="l00526"></a>00526     fprintf(file_op,<span class="stringliteral">&quot;end\n&quot;</span>);
<a name="l00527"></a>00527     fprintf(file_op,<span class="stringliteral">&quot;grid on; %%axis equal\n&quot;</span>);
<a name="l00528"></a>00528     fclose(file_op);  
<a name="l00529"></a>00529 }
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 
<a name="l00540"></a><a class="code" href="classWMG.html#a804fa71ec0d14ffa344cda92fc626bc3">00540</a> <span class="keywordtype">void</span> <a class="code" href="classWMG.html#a804fa71ec0d14ffa344cda92fc626bc3" title="Return coordinates of footstep reference points and rotation angles of footsteps (only for SS)...">WMG::getFootsteps</a>(
<a name="l00541"></a>00541         std::vector&lt;double&gt; &amp; x_coord,
<a name="l00542"></a>00542         std::vector&lt;double&gt; &amp; y_coord,
<a name="l00543"></a>00543         std::vector&lt;double&gt; &amp; angle_rot)
<a name="l00544"></a>00544 {
<a name="l00545"></a>00545     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>.size(); i++)
<a name="l00546"></a>00546     {
<a name="l00547"></a>00547         <span class="keywordflow">if</span> ((<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].type == <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449a4520b925caf066a47b733e827647cc55">FS_TYPE_SS_L</a>) || (<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].type == <a class="code" href="group__gWMG__API.html#gga45147e528b9243fa8842d38163498449a961ddc0fabfa0f842b7296b9413e644e">FS_TYPE_SS_R</a>))
<a name="l00548"></a>00548         {
<a name="l00549"></a>00549             x_coord.push_back(<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].x());
<a name="l00550"></a>00550             y_coord.push_back(<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].y());
<a name="l00551"></a>00551             angle_rot.push_back(<a class="code" href="classWMG.html#af4d5bb54feae52be9356e0f0003294ae" title="A vector of footsteps.">FS</a>[i].angle);
<a name="l00552"></a>00552         }
<a name="l00553"></a>00553     }
<a name="l00554"></a>00554 }
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
