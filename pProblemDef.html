<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>A sparse MPC solver for walking motion generation.: Problem definition</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">A sparse MPC solver for walking motion generation.
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Problem definition </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="pPDModel"></a>
Model of the system</h2>
<p>3D linear inverted pendulum is used as an approximate model of a humanoid robot.</p>
<p><img class="formulaInl" alt="$ \tilde{\mbm{c}}_{k+1} = \tilde{\mbm{A}}_k\tilde{\mbm{c}}_{k}+\tilde{\mbm{B}}_k\dddot{\mbm{c}}_{k}, \quad \dddot{\mbm{c}}_{k} = (\dddot{c}_k^x, \dddot{c}_k^y) $" src="form_0.png"/></p>
<p><img class="formulaInl" alt="$ \mbm{A} = \left[\hspace{-0.1cm} \begin{array}{cccccc} 1 &amp; T_k &amp; T_k^{2}/2 &amp; 0 &amp; 0 &amp; 0 \vspace{0.05cm}\\ 0 &amp; 1 &amp; T_k &amp; 0 &amp; 0 &amp; 0 \vspace{0.05cm}\\ 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \vspace{0.05cm}\\ 0 &amp; 0 &amp; 0 &amp; 1 &amp; T_k &amp; T_k^{2}/2 \vspace{0.05cm}\\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; T_k \vspace{0.05cm}\\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \end{array} \hspace{-0.1cm}\right], \quad \mbm{B}_k = \left[\hspace{-0.1cm} \begin{array}{cc} T_k^{3}/6 &amp; 0 \vspace{0.05cm} \\ T_k^{2}/2 &amp; 0 \vspace{0.05cm} \\ T_k &amp; 0\\ 0 &amp; T_k^{3}/6 \vspace{0.05cm} \\ 0 &amp; T_k^{2}/2 \vspace{0.05cm} \\ 0 &amp; T_k \end{array} \right] $" src="form_1.png"/></p>
<p>Where <img class="formulaInl" alt="$T_k$" src="form_2.png"/> is a time sampling period in the preview window.</p>
<p>Originally the state vector is defined as <img class="formulaInl" alt="$ \hat{\mbm{c}}_{k} = (c_k^x,\dot{c}_k^x,\ddot{c}_k^x,c_k^y,\dot{c}_k^y,\ddot{c}_k^y) $" src="form_3.png"/> where <img class="formulaInl" alt="$c^x_k, c^y_k$" src="form_4.png"/> are coordintes of the center of mass. <br/>
<br/>
</p>
<h2><a class="anchor" id="pPDVarSub"></a>
Variable substitution</h2>
<p><a class="anchor" id="pX_tilde"></a> After the variable substitution we get <img class="formulaInl" alt="$ \tilde{\mbm{c}}_{k} = (z_k^x,\dot{c}_k^x,\ddot{c}_k^x,z_k^y,\dot{c}_k^y,\ddot{c}_k^y) $" src="form_5.png"/> where <img class="formulaInl" alt="$z^x_k, z^y_k$" src="form_6.png"/> are coordintes of the ZMP.</p>
<p>The state and control input matrices are changed accordingly:</p>
<p><img class="formulaInl" alt="$ \tilde{\mbm{A}} = \left[ \begin{array}{cccccc} 1 &amp; T_k &amp; T_k^{2}/2-\Delta h_k &amp; 0 &amp; 0 &amp; 0 \vspace{0.05cm}\\ 0 &amp; 1 &amp; T_k &amp; 0 &amp; 0 &amp; 0 \vspace{0.05cm}\\ 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \vspace{0.05cm}\\ 0 &amp; 0 &amp; 0 &amp; 1 &amp; T_k &amp; T_k^{2}/2-\Delta h_k \vspace{0.05cm}\\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; T_k \vspace{0.05cm}\\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \end{array} \right], \quad \tilde{\mbm{B}} = \left[ \begin{array}{cc} T^{3}/6-hT &amp; 0 \\ T^{2}/2 &amp; 0\\ T &amp; 0\\ 0 &amp; T^{3}/6-hT \\ 0 &amp; T^{2}/2\\ 0 &amp; T \end{array} \right] $" src="form_7.png"/></p>
<p><a class="anchor" id="ph"></a> Here <img class="formulaInl" alt="$h = c_k^z/g$" src="form_8.png"/>, i.e. the height of center of mass divided by the norm of gravitational acceleration. <br/>
<br/>
</p>
<h2><a class="anchor" id="pPDObj"></a>
Objective function</h2>
<p>Output matrices for position and velocity:</p>
<p><img class="formulaInl" alt="$ \mbm{C}_p = \left[ \begin{array}{cccccc} 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\ \end{array}\right], \quad \mbm{C}_v = \left[ \begin{array}{cccccc} 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\ \end{array}\right], $" src="form_9.png"/></p>
<p><img class="formulaInl" alt="$ \tilde{f}(\tilde{\mbm{v}}) = \left[\hspace{-0.1cm}\begin{array}{c} \tilde{\mbm{v}}_c \\ \mbm{v}_u \end{array}\hspace{-0.1cm}\right]^T \left[\hspace{-0.1cm}\begin{array}{cc} \tilde{\mbm{H}}_c &amp; \mbm{0} \\ \mbm{0} &amp; \mbm{H}_u \end{array}\hspace{-0.1cm}\hspace{-0.1cm}\right] \left[\hspace{-0.1cm}\begin{array}{c} \tilde{\mbm{v}}_c \\ \mbm{v}_u \end{array}\hspace{-0.1cm}\right] + \left[\hspace{-0.1cm}\begin{array}{c} \tilde{\mbm{v}}_c \\ \mbm{v}_u \end{array}\hspace{-0.1cm}\right]^T \left[\hspace{-0.1cm}\begin{array}{c} \tilde{\mbm{g}}_c \\ \mbm{0} \end{array}\hspace{-0.1cm}\right] $" src="form_10.png"/></p>
<p>where</p>
<p><img class="formulaInl" alt="$\tilde{\mbm{v}}_c $" src="form_11.png"/> is a column vector containing state vectors and <img class="formulaInl" alt="${\mbm{v}}_u $" src="form_12.png"/> is a column vector containing control inputs.</p>
<p>or</p>
<p><img class="formulaInl" alt="$ f(\mbm{v}) = \frac{\gamma}{2}\sum_{k=0}^{N-1}\left(\dddot{\mbm{c}}_k^T\dddot{\mbm{c}}_k\right) + \frac{\alpha}{2}\sum_{k=1}^{N}\left(\dot{\mbm{c}}_k^T\dot{\mbm{c}}_k\right) + \frac{\beta}{2}\sum_{k=1}^{N}\left(\mbm{z}_k^T\mbm{z}_k - 2\mbm{z}_k^T\mbm{z}^{\mbox{ref}}_k\right), $" src="form_13.png"/></p>
<p><a class="anchor" id="pGains"></a> where <img class="formulaInl" alt="$\alpha, \beta, \gamma > 0$" src="form_14.png"/> are gains.</p>
<p><a class="anchor" id="pg"></a> <img class="formulaInl" alt="$ \frac{\beta}{2}\mbm{z}_k^T\mbm{z}_k - \beta\mbm{z}_k^T\mbm{z}^{\mbox{ref}}_k = \tilde{\mbm{c}}_k^T\frac{\beta}{2}\mbm{C}_p^T\mbm{C}_p\tilde{\mbm{c}}_k - \tilde{\mbm{c}}_k^T\underbrace{\beta\mbm{C}_p^T\mbm{z}^{\mbox{ref}}_k}_{\tilde{\mbm{q}}_k}, \\ \tilde{\mbm{v}}_c = \left[\begin{array}{c} \tilde{\mbm{c}}_1 \\ \vdots \\ \tilde{\mbm{c}}_N \end{array} \right], \quad \tilde{\mbm{g}}_c = \left[\begin{array}{c} -\tilde{\mbm{q}}_1 \\ \vdots \\ -\tilde{\mbm{q}}_N \end{array} \right], \quad \tilde{\mbm{v}} = \left[\begin{array}{c} \tilde{\mbm{v}}_c \\ \mbm{v}_u \end{array} \right] $" src="form_15.png"/></p>
<p><img class="formulaInl" alt="$\\ \mbm{H}_u = \left[ \begin{array}{ccc} \mbm{P} &amp; \dots &amp; \mbm{0} \\ \vdots &amp; \ddots &amp; \vdots \\ \mbm{0} &amp; \dots &amp; \mbm{P} \\ \end{array} \right],\quad \mbm{P} = \left[ \begin{array}{cc} \frac{\gamma}{2} &amp; 0 \\ 0 &amp; \frac{\gamma}{2} \\ \end{array} \right];\\ \tilde{\mbm{H}}_c = \left[ \begin{array}{ccc} \tilde{\mbm{Q}} &amp; \dots &amp; \mbm{0} \\ \vdots &amp; \ddots &amp; \vdots \\ \mbm{0} &amp; \dots &amp; \tilde{\mbm{Q}} \\ \end{array} \right], \quad \tilde{\mbm{Q}} = \left[ \begin{array}{cccccc} \frac{\beta}{2} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; \frac{\alpha}{2} &amp; 0 &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; r &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; \frac{\beta}{2} &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\alpha}{2} &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; r \\ \end{array} \right] $" src="form_16.png"/></p>
<p><a class="anchor" id="RegFactor"></a> Here <img class="formulaInl" alt="$r$" src="form_17.png"/> is a regularization factor, which makes the matrix nonsingular. <br/>
<br/>
</p>
<h2><a class="anchor" id="pPD_EC"></a>
Equality constraints</h2>
<p>The states of the system can be found using equations</p>
<p><img class="formulaInl" alt="$\\ \tilde{\mbm{c}}_1 = \tilde{\mbm{A}}_0\tilde{\mbm{c}}_0 + \tilde{\mbm{B}}_0\mbm{u}_0 \\ \tilde{\mbm{c}}_2 = \tilde{\mbm{A}}_1\tilde{\mbm{c}}_1 + \tilde{\mbm{B}}_1\mbm{u}_1 \\ \dots $" src="form_18.png"/></p>
<p>From these equations we can build equality constraints</p>
<p><img class="formulaInl" alt="$ \tilde{\mbm{E}}_c\tilde{\mbm{v}}_c + \tilde{\mbm{E}}_u\mbm{v}_u = \tilde{\mbm{e}}, $" src="form_19.png"/></p>
<p>Where</p>
<p><img class="formulaInl" alt="$\tilde{\mbm{e}} = (-\tilde{\mbm{A}}_0\tilde{\mbm{c}}_0, \mbm{0}, \dots, \mbm{0})$" src="form_20.png"/>,</p>
<p><img class="formulaInl" alt="$ \tilde{\mbm{E}}_c = \left[ \begin{array}{cccccc} -\mbm{I} &amp; \mbm{0} &amp; \mbm{0} &amp; \dots &amp; \mbm{0} &amp; \mbm{0} \\ \tilde{\mbm{A}}_0 &amp; -\mbm{I} &amp; \mbm{0} &amp; \dots &amp; \mbm{0} &amp; \mbm{0} \\ \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\ \mbm{0} &amp; \mbm{0} &amp; \mbm{0} &amp; \dots &amp; \tilde{\mbm{A}}_{N-1} &amp; -\mbm{I} \\ \end{array} \right], \quad \tilde{\mbm{E}}_u = \left[ \begin{array}{cccc} \tilde{\mbm{B}}_0 &amp; \dots &amp; \mbm{0} \\ \vdots &amp; \ddots &amp; \vdots \\ \mbm{0} &amp; \dots &amp; \tilde{\mbm{B}}_{N-1} \\ \end{array} \right]. $" src="form_21.png"/> <br/>
<br/>
</p>
<h2><a class="anchor" id="pPD_IC"></a>
Inequality constraints</h2>
<p><img class="formulaInl" alt="$ \left[ \begin{array}{cc} -1 &amp; 0 \\ 0 &amp; -1 \\ 1 &amp; 0 \\ 0 &amp; 1 \end{array} \right]\mbm{R}^T_k \mbm{C}_p \tilde{\mbm{c}}_k + \mbm{d}_{k} \geq \mbm{0}, $" src="form_22.png"/></p>
<p>Where <img class="formulaInl" alt="$ \mbm{R}_k = \left[ \begin{array}{cc} \cos\theta_k &amp; -\sin\theta_k \\ \sin\theta_k &amp; \cos\theta_k \end{array} \right] $" src="form_23.png"/> is a rotation matrix for the corresponding rectangular support. </p>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
